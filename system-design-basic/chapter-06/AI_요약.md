주요 주제
- 분산 시스템 설계 시 고려해야 할 사항
- 데이터 일관성 유지를 위한 방법


다음 할 일
- 레디스 카산드라 DB와 몽고DB 비교 검토
- 분산 시스템 설계 및 노드 관리 방안 검토


단락별 요약
키 값 저장소의 설계
- 키 값 저장소를 설계하는 게 이번 목표였음
- 키는 유일해야 되고 짧을수록 좋음
- 값에 오는 거는 문자열일 수도 있고 객체일 수도 있음
- 높은 가용성을 제공해야 되고 장애가 있더라도 응답을 해야 됨
- 레이턴시가 짧아야 되고 일관성 수준은 조정이 가능해야 됨

통신 장애를 감내하는 방법
- 통신 장애를 감내해야 되는 거니까 네트워크상 문제가 생겨도 시스템은 계속 동작을 해야 됨
- 세 가지를 동시에 만족할 수 없다고 했으니까 이 세 가지 모두의 교집합은 존재하지 않고 하나를 희생하는 방식으로 세 가지가 나올 수 있음
- 파티션 감내, CP, AP에 대해 설명하고 있음

장애 처리의 두 가지 관점
- 리드 라이트에 대한 정족수가 실제 서버의 개수만큼 커지면 쓰기 요청할 때랑 읽기 요청할 때 무조건 하나가 겹칠 수밖에 없음
- 약한 일관성 문제를 버저닝이나 벡터 시계 기술을 사용해서 해결할 수 있음
- 장애 처리를 어떻게 감지하고 대응을 할 거냐가 중요한 문제임
- 장애 처리를 할 때는 일시적인 격리를 할지 영구 장애 처리로 할지 두 가지 관점에서 달랐던 것 같음

데이터베이스 엔진의 역할
- 모든 노드가 같은 책임을 가지고 완전 분산 설계를 채택함
- 쓰기 경로를 보면 데이터 쓰기 요청이 오면 로그 파일을 기록하고 메모리 캐시에 기록이 되고 메모리 캐시가 가득 차면 디스크에 있는 에스 테이블에 기록을 함
- 쓰기를 자주 하면 안 좋으니까 데이터베이스 엔진 안에도 라이트 버퍼를 갖고 있는 걸로 알음
- 읽기도 캐시 메모리에서 먼저 검사를 하고 없으면 블루 필터에서 검사를 함

레디스의 장점
- 머클 트리의 헤드를 기준으로 같은지 여부를 판단함
- 워클트리는 메모리 캐시가 다 차면 ss 테이블이 만들어짐
- ss 테이블이 만들어질 때 기준으로 한 번씩 생성이 되고 이유터블이라서 인서트 할 때 비용에 영향을 주지 않음
- 레디스 카산드라 다이나모 DB를 어떻게 쓰면 좋을지 비교를 해 봄
- 몽고db는 안 알아봄
- 레디스 템플릿을 사용할 때 명시적으로 잭슨을 사용해서 하도록 하는 게 성능에 큰 차이가 있음
- 레디스를 사용할 때 모니터링 기준으로 에비션 레이트 애플리케이션 CPU 지지 99 레이트인지 보면 좋음

데이터 일관성
- 시스템 설계를 할 때 c랑 a를 잘 설계해야겠다고 생각함
- 데이터 일관성을 지키는 게 뭔가 금융권 밖에 생각이 안 남
- 인프라 팀에 맡기겠지만 노드 개수를 관리할 것 같음

분산 시스템의 설계
- 분산 시스템을 설계할 때 로우한 저 수준의 지식들인 것 같아서 나중에 처음 보는 분산 시스템을 봤을 때 원리 이해할 때 좋겠다 생각함
- 특정 노드가 영구 장애로 판단되면 노드를 제거하고 새로운 노드를 추가해야 함
- 특정 노드가 장애가 발생했을 때 데이터 하나하나씩 B-Tree나 그런 거 비교해 가면서 하면 부하가 많이 발생해서 해시트리라고 불리는 머클트리를 사용함

레투스의 단점
- 분산 락을 쓸 때 레디슨 아니면 레투스를 고려했던 것 같음
- 레투스가 약간 락 걸 때 폴링으로 계속 낙관적 락처럼 걸어서 부하가 심함
- 레디슨은 비동기 기반으로 SSE처럼 락 좋으면은 주고 그런 느낌이어서 많이 썼던 것 같음
